# 设置面板测试指南

## 🎯 新增功能

我已经为 Dify VS Code 插件添加了一个增强的设置面板，提供了直观的接口连通性测试功能。

## 🆕 功能特性

### 1. 可视化设置面板
- 🎨 美观的 WebView 界面
- 📝 表单式配置输入
- 🔒 密码字段安全输入
- 💡 实时帮助提示

### 2. 一键测试连接
- 🧪 **测试连接按钮**：在设置面板中直接测试 API 连通性
- ⚡ 实时状态反馈（测试中/成功/失败）
- 📊 详细的错误信息显示
- ✅ 成功后自动隐藏提示

### 3. 智能配置管理
- 💾 一键保存所有配置
- 🔄 重新加载当前配置
- 📋 配置验证和错误提示
- 🎯 VS Code 原生设置同步

## 🚀 使用方法

### 方法一：命令面板
1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 "Dify: Open Settings"
3. 回车打开设置面板

### 方法二：状态栏
1. 点击状态栏右下角的 "Dify: Ready" 按钮
2. 直接打开设置面板

### 方法三：VS Code 设置
1. 在 VS Code 设置中搜索 "Dify"
2. 点击 "testConnection" 选项来触发测试

## 🧪 测试连接功能

### 测试步骤
1. **填写配置**：
   - API Key：您的 Dify API 密钥
   - Workflow ID：代码补全工作流 ID
   - Base URL：API 基础地址（默认官方地址）

2. **点击测试**：
   - 点击 "测试连接" 按钮
   - 观察状态变化：测试中 → 成功/失败

3. **查看结果**：
   - ✅ 成功：显示绿色成功消息
   - ❌ 失败：显示红色错误信息和具体原因

### 测试状态说明
- 🔄 **测试中**：黄色背景，显示 "正在测试连接..."
- ✅ **成功**：绿色背景，显示 "连接成功！"
- ❌ **失败**：红色背景，显示具体错误信息

## 🔧 配置选项

### 必填项
- **API Key** *：Dify API 密钥
- **Workflow ID** *：工作流标识符

### 可选项
- **API 基础 URL**：私有部署时修改
- **启用插件**：总开关
- **自动触发补全**：输入时自动触发
- **触发延迟**：自动触发的延迟时间（100-5000ms）
- **上下文行数**：发送给 AI 的代码行数（5-50行）

## 🐛 调试测试

### 1. 启动调试
```bash
# 编译项目
npm run compile

# 在 VS Code 中按 F5 启动调试
```

### 2. 测试设置面板
在调试窗口中：
1. 按 `Ctrl+Shift+P`
2. 输入 "Dify: Open Settings"
3. 测试各项功能

### 3. 测试连接功能
1. 填写有效的 API Key 和 Workflow ID
2. 点击 "测试连接" 按钮
3. 观察状态变化和结果显示

### 4. 测试配置保存
1. 修改各项配置
2. 点击 "保存配置" 按钮
3. 重新加载验证配置是否保存成功

## 🎨 界面特性

### 响应式设计
- 适配 VS Code 主题色彩
- 支持深色/浅色主题
- 清晰的视觉层次

### 用户体验
- 实时状态反馈
- 友好的错误提示
- 自动隐藏成功消息
- 表单验证和帮助文本

### 无障碍支持
- 键盘导航友好
- 屏幕阅读器支持
- 高对比度兼容

## 🔍 故障排除

### 常见问题

1. **设置面板打不开**
   - 检查插件是否正确编译
   - 查看开发者控制台错误信息

2. **测试连接失败**
   - 验证 API Key 是否正确
   - 检查 Workflow ID 是否存在
   - 确认网络连接正常
   - 查看详细错误信息

3. **配置保存失败**
   - 检查 VS Code 权限
   - 重启 VS Code 重试

### 调试技巧
- 打开开发者工具查看 WebView 控制台
- 检查 VS Code 输出面板的日志
- 使用断点调试 settingsPanel.ts

---

## 🎉 总结

新的设置面板提供了：
- ✨ 直观的可视化配置界面
- 🧪 一键测试 API 连接功能
- 💾 便捷的配置管理
- 🎨 美观的用户界面
- 🔧 完整的错误处理

现在用户可以在设置面板中直接测试 Dify API 的连通性，无需离开 VS Code 环境！